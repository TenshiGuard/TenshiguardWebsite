{% extends "dashboard/base_dashboard.html" %}
{% block title %}Command Center | TenshiGuard{% endblock %}

{% block dash_content %}
<div class="row g-4 mb-4">
    <!-- ðŸ”¹ Header / Status -->
    <div class="col-12 d-flex justify-content-between align-items-center">
        <div>
            <h4 class="mb-1 fw-bold text-light">
                <i class="fa-solid fa-satellite-dish text-accent me-2"></i> Live Command Center
            </h4>
            <p class="text-muted small mb-0">Real-time threat monitoring and AI insights</p>
        </div>
        <div class="d-flex align-items-center gap-3">
            <span class="badge bg-dark border border-secondary text-light p-2">
                <i class="fa-solid fa-circle text-success me-1 fa-fade"></i> System Operational
            </span>
            <button class="btn btn-sm btn-outline-accent" onclick="location.reload()">
                <i class="fa-solid fa-rotate-right"></i>
            </button>
        </div>
    </div>
</div>

<!-- ðŸ”¹ KPI Cards -->
<div class="row g-3 mb-4">
    <div class="col-md-3">
        <div class="tg-card p-3 h-100 border-start border-4 border-danger">
            <div class="d-flex justify-content-between">
                <div>
                    <small class="text-muted text-uppercase fw-bold">Active Threats</small>
                    <h2 class="mb-0 fw-bold text-danger" id="kpi-threats">0</h2>
                </div>
                <i class="fa-solid fa-biohazard fa-2x text-danger opacity-50"></i>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="tg-card p-3 h-100 border-start border-4 border-warning">
            <div class="d-flex justify-content-between">
                <div>
                    <small class="text-muted text-uppercase fw-bold">Suspicious Events</small>
                    <h2 class="mb-0 fw-bold text-warning" id="kpi-suspicious">0</h2>
                </div>
                <i class="fa-solid fa-triangle-exclamation fa-2x text-warning opacity-50"></i>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="tg-card p-3 h-100 border-start border-4 border-info">
            <div class="d-flex justify-content-between">
                <div>
                    <small class="text-muted text-uppercase fw-bold">AI Signals</small>
                    <h2 class="mb-0 fw-bold text-info" id="kpi-signals">0</h2>
                </div>
                <i class="fa-solid fa-brain fa-2x text-info opacity-50"></i>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="tg-card p-3 h-100 border-start border-4 border-success">
            <div class="d-flex justify-content-between">
                <div>
                    <small class="text-muted text-uppercase fw-bold">Protected Devices</small>
                    <h2 class="mb-0 fw-bold text-success" id="kpi-devices">0</h2>
                </div>
                <i class="fa-solid fa-shield-halved fa-2x text-success opacity-50"></i>
            </div>
        </div>
    </div>
</div>

<!-- ðŸ”¹ Main Grid -->
<div class="row g-4">
    <!-- Left: Live Feed -->
    <div class="col-lg-8">
        <div class="tg-card h-100">
            <div
                class="card-header bg-transparent border-bottom border-secondary d-flex justify-content-between align-items-center p-3">
                <h6 class="mb-0 fw-bold"><i class="fa-solid fa-list-ul me-2 text-accent"></i> Live Threat Feed</h6>
                <span class="badge bg-dark text-muted border border-secondary">Real-time</span>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
                    <table class="table table-dark table-hover align-middle mb-0">
                        <thead class="sticky-top bg-dark">
                            <tr class="text-muted small text-uppercase">
                                <th class="ps-3">Time</th>
                                <th>Severity</th>
                                <th>Type</th>
                                <th>Description</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="live-feed-body">
                            <tr>
                                <td colspan="5" class="text-center py-5 text-muted">
                                    <i class="fa-solid fa-spinner fa-spin me-2"></i> Connecting to neural core...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Right: AI Insight & Details -->
    <div class="col-lg-4">
        <div class="tg-card h-100">
            <div class="card-header bg-transparent border-bottom border-secondary p-3">
                <h6 class="mb-0 fw-bold"><i class="fa-solid fa-robot me-2 text-info"></i> AI Analysis</h6>
            </div>
            <div class="card-body p-3">
                <!-- Selected Event Details -->
                <div id="ai-panel-empty" class="text-center py-5 text-muted">
                    <i class="fa-solid fa-arrow-left me-2"></i> Select an event to analyze
                </div>

                <div id="ai-panel-content" class="d-none">
                    <div class="mb-3">
                        <span class="badge bg-danger mb-2" id="ai-severity">CRITICAL</span>
                        <h5 class="fw-bold mb-1" id="ai-title">Ransomware Detected</h5>
                        <small class="text-muted" id="ai-time">Just now</small>
                    </div>

                    <div class="p-3 bg-dark rounded border border-secondary mb-3">
                        <small class="text-uppercase text-muted fw-bold d-block mb-1">Analysis</small>
                        <p class="small mb-0" id="ai-analysis">
                            AI is analyzing this threat...
                        </p>
                    </div>

                    <div class="p-3 bg-dark rounded border border-secondary mb-3">
                        <small class="text-uppercase text-muted fw-bold d-block mb-1">Mitigation</small>
                        <ul class="small mb-0 ps-3 text-warning" id="ai-mitigation">
                            <li>Isolate device immediately.</li>
                        </ul>
                    </div>

                    <button class="btn btn-accent w-100" id="btn-ask-ai">
                        <i class="fa-solid fa-wand-magic-sparkles me-2"></i> Ask AI for Details
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{{ super() }}
<script>
    // Placeholder for real-time logic (will implement in next step)
    console.log("Command Center Loaded");
</script>
<script src="{{ url_for('static', filename='js/command_center.js') }}"></script>
{% endblock %}