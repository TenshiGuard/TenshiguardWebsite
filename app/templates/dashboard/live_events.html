{% extends "dashboard/base_dashboard.html" %}

{% block dash_content %}
<div class="container-fluid">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h4 class="mb-1 fw-bold text-accent">
        <i class="fa-solid fa-tower-broadcast me-2"></i> Live Events
      </h4>
      <p class="text-muted mb-0">Real-time monitoring of security events across all endpoints.</p>
    </div>
    <div>
      <button class="btn btn-outline-light btn-sm" onclick="window.location.reload()">
        <i class="fa-solid fa-rotate me-1"></i> Refresh
      </button>
    </div>
  </div>

  <!-- Events Table -->
  <div class="tg-panel p-0 overflow-hidden">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead>
          <tr>
            <th class="ps-4">Timestamp (UTC)</th>
            <th>Device</th>
            <th>Event Type</th>
            <th>Severity</th>
            <th>Description</th>
            <th>Mitigation</th>
          </tr>
        </thead>
        <tbody>
          {% for event, device in events %}
          <tr>
            <td class="ps-4 text-muted small">{{ event.ts.strftime('%Y-%m-%d %H:%M:%S') }}</td>
            <td>
              {% if device %}
              <div class="d-flex flex-column">
                <span class="fw-bold text-light">{{ device.hostname }}</span>
                <span class="small text-muted">{{ device.ip_address }}</span>
              </div>
              {% else %}
              <span class="text-muted fst-italic">Unknown Device</span>
              {% endif %}
            </td>
            <td>
              <span class="badge bg-dark border border-secondary text-light">
                {{ event.event_type|upper }}
              </span>
            </td>
            <td>
              {% if event.severity == 'critical' %}
              <span class="badge bg-critical">CRITICAL</span>
              {% elif event.severity == 'high' %}
              <span class="badge bg-danger">HIGH</span>
              {% elif event.severity == 'medium' %}
              <span class="badge bg-warning">MEDIUM</span>
              {% elif event.severity == 'low' %}
              <span class="badge bg-success">LOW</span>
              {% else %}
              <span class="badge bg-info">INFO</span>
              {% endif %}
            </td>
            <td>
              <div class="text-light">{{ event.message or event.detail or 'No details available' }}</div>
            </td>
            <td>
              {% if event.mitigation %}
              <div class="text-success small">
                <i class="fa-solid fa-check-circle me-1"></i> {{ event.mitigation }}
              </div>
              {% else %}
              <span class="text-muted small">-</span>
              {% endif %}
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="6" class="text-center py-5 text-muted">
              <i class="fa-solid fa-inbox fa-3x mb-3 opacity-50"></i>
              <p>No events recorded yet.</p>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}